<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Block Device Drivers for Littlefs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Block Device Drivers for Littlefs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Block Device Drivers for littlefs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Overview</h2>
<p>Provides a set of block device drivers for use with the <a href="https://github.com/littlefs-project/littlefs">littlefs</a> file system. The interface of the drivers is very similar to <a href="https://github.com/littlefs-project/littlefs/blob/master/bd/lfs_rambd.h">lfs_rambd.h</a> provided with littlefs. See the API reference manual for driver-specific information.</p>
<h2>Features</h2>
<ul>
<li>Supports SPI flash and SD card (card mode) block devices</li>
<li>Each driver provides a function to fetch the default configuration of the block device</li>
<li>Implements thread safety for use with multi-threaded RTOS environments using the <a href="https://github.com/cypresssemiconductorco/abstraction-rtos">abstraction-rtos</a> library</li>
<li>Built on top of existing drivers such as <a href="https://github.com/cypresssemiconductorco/serial-flash">serial-flash</a> and HAL</li>
<li>Supports Serial Flash Discoverable Parameter (SFDP) mode for SPI flash memories</li>
</ul>
<h2>Quick Start</h2>
<p>See the <a href="https://github.com/cypresssemiconductorco/mtb-example-psoc6-filesystem-littlefs-freertos">mtb-example-psoc6-filesystem-littlefs-freertos</a> code example that shows implementing littlefs file system on SD card and QSPI NOR flash.</p>
<ol type="1">
<li>Create an empty application using the Project Creator tool in ModusToolbox® software.</li>
<li>Add <em>mtb-littlefs</em> and <em>retarget-io</em> libraries using the Library Manager tool.</li>
<li>Add the below code to <em>main.c</em>.</li>
<li>Open a serial terminal.</li>
<li>Build the application and program the kit.</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cybsp.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;cy_retarget_io.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;lfs.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;lfs_spi_flash_bd.h&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> check_status(<span class="keywordtype">char</span> *message, uint32_t status)</div><div class="line">{</div><div class="line">   <span class="keywordflow">if</span> (0u != status)</div><div class="line">   {</div><div class="line">       printf(<span class="stringliteral">&quot;\n================================================================================\n&quot;</span>);</div><div class="line">       printf(<span class="stringliteral">&quot;\nFAIL: %s\n&quot;</span>, message);</div><div class="line">       printf(<span class="stringliteral">&quot;Error Code: 0x%08&quot;</span>PRIx32<span class="stringliteral">&quot;\n&quot;</span>, status);</div><div class="line">       printf(<span class="stringliteral">&quot;\n================================================================================\n&quot;</span>);</div><div class="line"></div><div class="line">       <span class="keywordflow">while</span>(<span class="keyword">true</span>);</div><div class="line">   }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">   cy_rslt_t result;</div><div class="line">   uint32_t boot_count = 0;</div><div class="line"></div><div class="line">   <span class="comment">/* variables used by the filesystem */</span></div><div class="line">   lfs_t lfs;</div><div class="line">   <span class="keyword">struct </span>lfs_config lfs_cfg;</div><div class="line">   lfs_file_t file;</div><div class="line">   <a class="code" href="group__group__lfs__spi__flash__bd.html#structlfs__spi__flash__bd__config__t">lfs_spi_flash_bd_config_t</a> bd_cfg;</div><div class="line"></div><div class="line">   <span class="comment">/* Initialize the device and board peripherals */</span></div><div class="line">   result = cybsp_init() ;</div><div class="line">   CY_ASSERT (result == CY_RSLT_SUCCESS);</div><div class="line"></div><div class="line">   <span class="comment">/* Enable global interrupts */</span></div><div class="line">   __enable_irq();</div><div class="line"></div><div class="line">   <span class="comment">/* Initialize retarget-io to use the debug UART port */</span></div><div class="line">   cy_retarget_io_init(CYBSP_DEBUG_UART_TX, CYBSP_DEBUG_UART_RX, CY_RETARGET_IO_BAUDRATE);</div><div class="line"></div><div class="line">   printf(<span class="stringliteral">&quot;\nIncrementing the boot count on SPI flash\n\n&quot;</span>);</div><div class="line"></div><div class="line">   <span class="comment">/* Get the default configuration for the SPI flash block device. */</span></div><div class="line">   <a class="code" href="group__group__lfs__spi__flash__bd.html#gadc512a6ca48b34ab5f124a8d4a097595">lfs_spi_flash_bd_get_default_config</a>(&amp;bd_cfg);</div><div class="line"></div><div class="line">   <span class="comment">/* Initialize the pointers in lfs_cfg to NULL. */</span></div><div class="line">   memset(&amp;lfs_cfg, 0, <span class="keyword">sizeof</span>(lfs_cfg));</div><div class="line"></div><div class="line">   <span class="comment">/* Create the SPI flash block device. */</span></div><div class="line">   result = <a class="code" href="group__group__lfs__spi__flash__bd.html#ga2757e78734174021644b85d7e2f6b708">lfs_spi_flash_bd_create</a>(&amp;lfs_cfg, &amp;bd_cfg);</div><div class="line">   check_status(<span class="stringliteral">&quot;Creating SPI flash block device failed.&quot;</span>, result);</div><div class="line"></div><div class="line">   printf(<span class="stringliteral">&quot;Number of blocks: %&quot;</span>PRIu32<span class="stringliteral">&quot;\n&quot;</span>, lfs_cfg.block_count);</div><div class="line">   printf(<span class="stringliteral">&quot;Erase block size: %&quot;</span>PRIu32<span class="stringliteral">&quot; bytes\n&quot;</span>, lfs_cfg.block_size);</div><div class="line">   printf(<span class="stringliteral">&quot;Prog size: %&quot;</span>PRIu32<span class="stringliteral">&quot; bytes\n&quot;</span>, lfs_cfg.prog_size);</div><div class="line"></div><div class="line">   <span class="comment">/* Mount the filesystem */</span></div><div class="line">   <span class="keywordtype">int</span> err = lfs_mount(&amp;lfs, &amp;lfs_cfg);</div><div class="line"></div><div class="line">   <span class="comment">/* Reformat if we cannot mount the filesystem.</span></div><div class="line"><span class="comment">    * This should only happen on the first boot.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keywordflow">if</span> (err) {</div><div class="line">       lfs_format(&amp;lfs, &amp;lfs_cfg);</div><div class="line">       lfs_mount(&amp;lfs, &amp;lfs_cfg);</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">/* Read the current boot count. */</span></div><div class="line">   lfs_file_open(&amp;lfs, &amp;file, <span class="stringliteral">&quot;boot_count&quot;</span>, LFS_O_RDWR | LFS_O_CREAT);</div><div class="line">   lfs_file_read(&amp;lfs, &amp;file, &amp;boot_count, <span class="keyword">sizeof</span>(boot_count));</div><div class="line"></div><div class="line">   <span class="comment">/* Update the boot count. */</span></div><div class="line">   boot_count += 1;</div><div class="line">   lfs_file_rewind(&amp;lfs, &amp;file);</div><div class="line">   lfs_file_write(&amp;lfs, &amp;file, &amp;boot_count, <span class="keyword">sizeof</span>(boot_count));</div><div class="line"></div><div class="line">   <span class="comment">/* The storage is not updated until the file is closed successfully. */</span></div><div class="line">   lfs_file_close(&amp;lfs, &amp;file);</div><div class="line"></div><div class="line">   <span class="comment">/* Release any resources we were using. */</span></div><div class="line">   lfs_unmount(&amp;lfs);</div><div class="line"></div><div class="line">   <span class="comment">/* Print the boot count. */</span></div><div class="line">   printf(<span class="stringliteral">&quot;\nboot_count: %&quot;</span>PRIu32<span class="stringliteral">&quot;\n&quot;</span>, boot_count);</div><div class="line"></div><div class="line">   <span class="comment">/* Free the resources associated with the block device. */</span></div><div class="line">   <a class="code" href="group__group__lfs__spi__flash__bd.html#gafcfe68f0485727b03ea984f279a4ae6b">lfs_spi_flash_bd_destroy</a>(&amp;lfs_cfg);</div><div class="line"></div><div class="line">   <span class="keywordflow">for</span> (;;) {}</div><div class="line">}</div></div><!-- fragment --><h2>Usage Instructions</h2>
<h3>When used in an RTOS environment:</h3>
<ol type="1">
<li>Add <a href="https://github.com/cypresssemiconductorco/freertos">FreeRTOS</a> using the Library Manager tool if FreeRTOS is your choice of RTOS.</li>
<li>Add <a href="https://github.com/cypresssemiconductorco/abstraction-rtos">abstraction-rtos</a> using the Library Manager tool if you are using an RTOS other than FreeRTOS. <em>abstraction-rtos</em> is added automatically when you add FreeRTOS using the Library Manager.</li>
<li>Add <code>FREERTOS</code> to the components list if you are using FreeRTOS.</li>
<li>Add <code>DEFINES=LFS_THREADSAFE</code> to enable thread-safety for the littlefs APIs.</li>
<li>Add <code>COMPONENTS=RTOS_AWARE</code> in the Makefile to enable RTOS-friendly features such as waiting on a semaphore until read completion is indicated through an interrupt or a callback.</li>
</ol>
<p><b>Note:</b> The source files under *&lt;littlefs_path&gt;/bd* are ignored from auto-discovery and therefore they will be excluded from compilation because some of the files (e.g., <em>lfs_filebd.c</em>) use POSIX file APIs such as <code>open()</code> and <code>close()</code>. POSIX APIs are not supported by ModusToolbox. If you implement POSIX APIs, you can include those files for compilation by adding them to the <code>SOURCES</code> and <code>INCLUDES</code> variables in the Makefile.</p>
<h2>Dependencies</h2>
<p>The dependencies except <em>abstraction-rtos</em> are automatically pulled in when you run the <code>make getlibs</code> command in ModusToolbox.</p>
<ul>
<li><a href="https://github.com/littlefs-project/littlefs">littlefs</a></li>
<li><a href="https://github.com/cypresssemiconductorco/serial-flash">serial-flash</a></li>
<li><p class="startli"><a href="https://github.com/cypresssemiconductorco/abstraction-rtos">abstraction-rtos</a> library if RTOS support is required.</p>
<p class="startli"><b>Note:</b> <em>abstraction-rtos</em> is automatically pulled in only when you add FreeRTOS using the Library Manager; otherwise, you need to add it manually.</p>
</li>
</ul>
<h2>Supported Toolchains</h2>
<ul>
<li>GNU Arm® Embedded Compiler v9.3.1 (<code>GCC_ARM</code>)</li>
<li>Arm compiler v6.13 (<code>ARM</code>)</li>
<li>IAR C/C++ compiler v8.42.2 (<code>IAR</code>)</li>
</ul>
<h2>Supported Devices</h2>
<ul>
<li>All PSoC® 6 MCUs</li>
</ul>
<h2>More Information</h2>
<ul>
<li><a href="https://cypresssemiconductorco.github.io/mtb-littlefs/api_reference_manual/html/index.html">API Reference Guide</a></li>
<li><a href="https://github.com/cypresssemiconductorco/mtb-littlefs/blob/master/RELEASE.md">Release Notes</a></li>
<li><a href="https://github.com/cypresssemiconductorco/mtb-example-psoc6-filesystem-littlefs-freertos">mtb-example-psoc6-filesystem-littlefs-freertos</a> code example</li>
<li><a href="https://github.com/littlefs-project/littlefs">littlefs filesystem</a></li>
<li><a href="https://github.com/cypresssemiconductorco">Cypress Semiconductor GitHub</a></li>
<li><a href="https://www.cypress.com/products/modustoolbox-software-environment">ModusToolbox</a></li>
<li><a href="https://github.com/cypresssemiconductorco/Code-Examples-for-ModusToolbox-Software">PSoC 6 MCU Code Examples using ModusToolbox</a></li>
<li><a href="https://github.com/cypresssemiconductorco/psoc6-middleware">PSoC 6 MCU Middleware</a></li>
<li><a href="https://community.cypress.com/docs/DOC-14644">PSoC 6 MCU Resources - KBA223067</a></li>
</ul>
<hr/>
<p> © 2021 Cypress Semiconductor Corporation, an Infineon Technologies Company. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>Block Device Drivers for Littlefs</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
